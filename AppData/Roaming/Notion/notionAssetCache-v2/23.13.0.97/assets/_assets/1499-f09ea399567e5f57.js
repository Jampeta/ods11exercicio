"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1499],{3553:(e,t,o)=>{o.d(t,{Z:()=>ge});var n=o(67294),i=o(73935),s=o(83355),r=o(18466),l=o(1302),a=o(86628),c=o(24405),d=o(8848),u=o(72126),h=o(99553),p=o(52989),b=o(24677),f=o(98104),m=o(82530),v=o(75330),g=o(84064),S=o(43250),C=o(12534),w=o(39500),k=o(16339),M=o(50694),A=o(69784),x=o(50628),y=o(27724),T=o(4827),R=o(86486),j=o(23063),Z=o(9612),I=o(51454),E=o(73744),_=o(17504),B=o(77546),D=o(439),O=o(48779),H=o(94841),F=o(95802),P=o(807),L=o(77080),z=o(480),N=o(47453),V=o(9291),K=o(36610),U=o(42858),G=o(84084),W=o(28314),J=o(65598),Y=o(64921),q=o(26388),X=o(65200),$=o(85893);const Q=2,ee=24,te=(0,V.defineMessages)({ariaLabelApple:{id:"block.selectableAddMenu.ariaLabel.apple",defaultMessage:"Click to add below. Option-click to add a block above"},ariaLabelWindows:{id:"block.selectableAddMenu.ariaLabel.windows",defaultMessage:"Click to add below. Alt-click to add a block above"}});const oe=function(e){let{store:t,offsetTop:o}=e;window.__c={n:"SelectableAddMenu"};const n=(0,V.useIntl)(),i=(0,c.Fg)(),s=(0,z.O7)();return(0,z.MO)()?null:(0,$.jsx)(q.ZP,{placement:q.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,$.jsx)(ie,{}),render:e=>(0,$.jsx)(Y.Z,{disallowTabbing:!0,onClick:()=>function(e,t){const o=W.lF.state.option,n=F.C.findSelectablesFromStore(t).find((e=>Boolean(e.props.onInsertRowBelow)));o?n&&n.props.onInsertRowAbove?m.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{n.props.onInsertRowAbove&&n.props.onInsertRowAbove({transaction:e})}}):m.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addAbove",perform:o=>{U.uE({environment:e,blocks:[t],transaction:o})}}):J.PF(t)?G.hb({environment:e,blockStore:t}):n&&n.props.onInsertRowBelow?m.createAndCommit({userAction:"SelectableAddMenu.handleClick.onInsertRowBelow",environment:e,perform:e=>{n.props.onInsertRowBelow&&n.props.onInsertRowBelow({transaction:e})}}):m.createAndCommit({environment:e,userAction:"SelectableAddMenu.handleClick.addBelow",perform:o=>{U.ZJ({environment:e,blocks:[t],transaction:o})}});K.eT(e),R.default.reset()}(s,t),style:ne(o,t,s,i),ariaLabel:n.formatMessage(s.device.isApple?te.ariaLabelApple:te.ariaLabelWindows),...e,children:(0,N.R)({width:16})})})};function ne(e,t,o,n){const i=(0,D.zt)(e,t),s=(0,D.tx)(o,ee+Q+X.Z.width,t);return{display:"flex",alignItems:"center",justifyContent:"center",fill:n.lightIconColor,position:"absolute",top:i,left:-s,width:ee,height:ee,borderRadius:4,pointerEvents:"auto",cursor:"-webkit-grab"}}function ie(){window.__c={n:"TooltipComponent"};const e=(0,c.Fg)(),t=(0,z.O7)(),o={color:e.mediumInvertedTextColor};return(0,$.jsxs)("div",{style:{textAlign:"center"},children:[(0,$.jsx)(V.FormattedMessage,{defaultMessage:"Click <mediumcolor>to add below</mediumcolor>",id:"block.selectableAddMenu.tooltip.addBlockBelow",values:{mediumcolor:e=>(0,$.jsx)("span",{style:o,children:e})}}),(0,$.jsx)("div",{children:t.device.isApple?(0,$.jsx)(V.FormattedMessage,{defaultMessage:"Option-click <mediumcolor>to add above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove",values:{mediumcolor:e=>(0,$.jsx)("span",{style:o,children:e})}}):(0,$.jsx)(V.FormattedMessage,{defaultMessage:"Alt-click <mediumcolor>to add a block above</mediumcolor>",id:"block.selectableAddMenu.tooltip.addAbove.windows",values:{mediumcolor:e=>(0,$.jsx)("span",{style:o,children:e})}})})]})}var se=o(95855),re=o(18821),le=o(73063);const ae=function(e){window.__c={n:"SelectableCommentMenu"};const t=(0,z.O7)(),o=(0,z.Fy)(),{mediumInvertedTextColor:i}=(0,c.Fg)(),s=(0,V.useIntl)(),{store:r,shouldOffsetLeft:l}=e,d=(0,a.VK)((()=>l?(0,D.tx)(t,26+X.Z.width,r):ee+8),[t,r,l]),u=(0,n.useCallback)((()=>{re.yw({environment:t,blockStore:r})}),[t,r]);return o.isMobile?null:(0,$.jsx)("div",{style:ce(e.offsetTop,d),onMouseDown:C.$0,children:(0,$.jsx)(q.ZP,{placement:q.ug.Bottom,delayThreshold:300,renderTooltip:()=>(0,$.jsx)(V.FormattedMessage,{defaultMessage:"Click <invertedcolor>to add a comment</invertedcolor>",id:"selectableCommentMenu.addCommentPrompt.tooltip",values:{invertedcolor:e=>(0,$.jsx)("span",{style:{color:i},children:e})}}),render:e=>(0,$.jsx)(le.Z,{ariaLabel:s.formatMessage({id:"selectableCommentMenu.iconButton",defaultMessage:"Comment"}),disallowTabbing:!0,icon:se.z,onClick:u,isLightIconColor:!0,...e})})})};function ce(e,t){return{position:"absolute",top:e,left:-t}}class de extends s.Z{constructor(){super(...arguments),this.verticalScrollableAncestor=void 0,this.horizontalScrollableAncestor=void 0,this.isCommentMenu=!1,this.showHoverMenu=!1,this.disableHoverMenuDrag=!1,this.targetSelectableStore=this.createComputedStore((()=>{const{target:e}=this.props;return F.C.findSelectablesFromStore(e).find((e=>Boolean(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)))})),this.targetRectStore=this.createComputedStore((()=>{var e;return null===(e=this.targetSelectableStore.state)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect()})),this.isSuggestModeStore=this.createComputedStore((()=>{const{target:e}=this.props;return!!L.default.checkGate("human_suggested_edits")&&"suggest"===P.Z.getMode(e)})),this.handleScroll=()=>{this.targetRectStore.enqueueRecompute()}}UNSAFE_willMount(e){super.UNSAFE_willMount(e);const t=this.targetSelectableStore.state;if(!t)return;this.isCommentMenu=Boolean(t.props.shouldShowCommentMenu),this.showHoverMenu=Boolean(t.props.shouldShowHoverMenu);const o=t.getNode();o&&(this.verticalScrollableAncestor=(0,B.VW)(o),this.verticalScrollableAncestor&&(0,E.lj)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor=(0,B.xH)(o),this.horizontalScrollableAncestor&&this.horizontalScrollableAncestor!==this.verticalScrollableAncestor&&(0,E.lj)(this.horizontalScrollableAncestor,"scroll",this.handleScroll),this.handleScroll())}willUnmount(){super.willUnmount(),this.verticalScrollableAncestor&&(0,E.ZV)(this.verticalScrollableAncestor,"scroll",this.handleScroll),this.horizontalScrollableAncestor&&(0,E.ZV)(this.horizontalScrollableAncestor,"scroll",this.handleScroll)}renderComponent(){var e;const{target:t,container:o}=this.props,n=o?o.getBoundingClientRect():void 0,i=this.targetRectStore.state,s=this.isSuggestModeStore.state,r=i?i.top-(n?n.top:0):void 0,l=i?i.left-(n?n.left:0):void 0,a=(0,O.Fn)(this.environment),c="editor"===this.props.target.getRole()||"read_and_write"===this.props.target.getRole()||"edit"===(null===(e=this.pageContext)||void 0===e||null===(e=e.publicEditModeStore.state)||void 0===e?void 0:e.permission),d="external_object_instance_page"===t.getType(),u=this.pageContext&&(0,H.Kj)(this.pageContext.pageStore.id);return(0,_.Z)((e=>{var o;return(0,$.jsxs)("div",{style:{position:"absolute",left:l,top:r,zIndex:I.Mo},...e,children:[this.isCommentMenu&&!t.isNavigableAncestorLocked()&&(0,$.jsx)(ae,{store:t,offsetTop:(0,D.oJ)(t),shouldOffsetLeft:this.showHoverMenu||a}),this.showHoverMenu&&(0,$.jsx)(X.Z,{store:t,offsetTop:(0,D.oJ)(t),disableDrag:this.disableHoverMenuDrag||s,isWorkspaceAdmin:a,hasEditorPermissions:c}),(!t.isNavigableAncestorLocked()||"collection"===(null===(o=t.getParentStore())||void 0===o?void 0:o.table))&&!this.isCommentMenu&&c&&!d&&!u&&!s&&(0,$.jsx)(oe,{store:t,offsetTop:(0,D.oJ)(t)})]})}))}}de.displayName="SelectableHoverMenuOverlayItem";const ue=de,he={position:"absolute",top:0,left:0};class pe extends s.Z{constructor(){super(...arguments),this.container=void 0,this.targetStore=this.createComputedStore((()=>{const e=R.default.state;if(e.isOpen&&e.container===this.props.selectableContainer)return e.currentStore})),this.handleContainerMount=e=>{e&&(this.container=e)}}renderComponent(){return(0,$.jsx)("div",{style:he,ref:this.handleContainerMount,children:(0,$.jsx)(Z.Z,{render:()=>u.oA([this.renderCurrentTarget()])})})}renderCurrentTarget(){const e=this.targetStore.state;if(e)return(0,$.jsx)(j.Z,{isVisible:!0,animationStyle:{opacity:1},enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>(0,$.jsx)(ue,{container:this.container,target:e})},e.id)}}pe.displayName="SelectableHoverMenuOverlay";const be=pe;class fe extends s.Z{constructor(){super(...arguments),this.observer=void 0,this.handleMouseDown=e=>{const{device:t}=this.environment;this.props.disableRectangularSelection||(t.isPhone?(0,C.ZP)({event:e,context:C.Af.EditorMouseDown,callback:()=>{b.ZH(this.environment),v.wG(),M.HM.clearSelection()}}):(0,C.ZP)({event:e,context:C.Af.EditorMouseDown,callback:()=>{1!==e.button&&(e.preventDefault(),p.AI({environment:this.environment,target:e.target,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1}))}}))},this.handleClick=e=>{(function(e){return x.Z.hasBeenUpdatedSince(e.timeStamp)})(e)||this.props.store.canEdit()&&(0,C.ZP)({event:e,context:C.Af.EditorClick,callback:()=>{var t;if(null!==(t=y.default.getDefaultContainerFromTarget(e.target))&&void 0!==t&&t.isPeekRenderer()||h.E5(this.environment),!w.X9()&&!this.props.disableEditNearestBlock){const{clientX:t,clientY:o,target:n}=e;l.default.afterNextFlush((()=>{m.createAndCommit({userAction:"SelectableContainer.click",environment:this.environment,perform:e=>f.jh(this.environment,{x:t,y:o,target:n instanceof Element?n:void 0},e)})}))}}})},this.shouldRenderRectangularSelectionRectStore=this.createComputedStore((()=>Boolean(A.default.state.isActive&&A.default.state.defaultContainer===this)))}get registries(){return[k.Z]}didMount(){if(super.didMount(),this.props.isDefaultContainer){const e=this.props.isRootContainer?u.G0([this],y.default.state.defaultContainerStack||[]):u.G0(y.default.state.defaultContainerStack||[],[this]);y.default.setState({...y.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(this.props.droppable){const e=this.props.isRootContainer?u.G0([this],y.default.state.droppableContainerStack||[]):u.G0(y.default.state.droppableContainerStack||[],[this]);y.default.setState({...y.default.state,droppableContainerStack:e})}b.Jy();const e=i.findDOMNode(this);e&&(this.observer=new MutationObserver(me),this.observer.observe(e,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))}willUnmount(){if(super.willUnmount(),this.props.isDefaultContainer){const e=u.zu(y.default.state.defaultContainerStack||[],this);y.default.setState({...y.default.state,defaultContainerStack:e,pivot:void 0,anchor:void 0,anchorContainer:void 0})}if(this.props.droppable){const e=u.zu(y.default.state.droppableContainerStack||[],this);y.default.setState({...y.default.state,droppableContainerStack:e})}this.observer&&this.observer.disconnect()}renderComponent(){var e;const{render:t}=this.props;return(0,$.jsx)(g.ld,{value:{selectableContainer:this,closestSelectable:null===(e=this.context.selectable)||void 0===e?void 0:e.closestSelectable},children:(0,$.jsx)(T.Z,{open:this.shouldRenderRectangularSelectionRectStore.state,origin:t({selectableEvents:{onMouseDown:this.handleMouseDown,onClick:this.handleClick},selectableHoverMenuOverlay:(0,$.jsx)(be,{selectableContainer:this})}),children:(0,$.jsx)(ve,{isDefaultContainer:this.props.isDefaultContainer})})})}isPeekRenderer(){return this.props.isPeekRenderer}}fe.displayName="SelectableContainer",fe.contextTypes={...g.Tf,...s.w};const me=e=>{let t=!0;if(e.length<=10){const{selectableElementRectMap:o}=r.Z.withListenerIgnored((()=>x.Z.getState()));t=e.some((e=>function(e,t){const o=t.target instanceof Element?t.target:t.target.parentElement;if(!o)return!0;const n=o.closest(`.${S.euV}`);if(!n)return!0;const i=e.get(n);if(!i)return!0;const s=n.getBoundingClientRect();return!(i.x===s.x&&i.y===s.y&&i.width===s.width&&i.height===s.height)}(o,e)))}t&&b.Ch()};function ve(e){window.__c={n:"RectangularSelectionRect"};const{isDefaultContainer:t}=e,{currentRect:o,isActive:n,showSelectionRect:i}=(0,a.VK)((()=>A.default.state.isActive?A.default.state:{currentRect:void 0,isActive:!1,showSelectionRect:!1}),[]),s=(0,c.yK)((()=>({selection:{position:"absolute",pointerEvents:"none",backgroundColor:d.ZP.blueWithAlpha(.14),border:"1px solid transparent",left:null==o?void 0:o.left,top:null==o?void 0:o.top,width:o?o.right-o.left:0,height:o?o.bottom-o.top:0}})),[o]);return n&&i&&t?(0,$.jsx)("div",{style:s.selection}):null}const ge=fe},65200:(e,t,o)=>{o.d(t,{Z:()=>w});var n=o(67294),i=o(480),s=o(86628),r=o(24405),l=o(36610),a=o(24677),c=o(439),d=o(77907),u=o(69454),h=o(86486),p=o(31945),b=o(50478),f=o(53437),m=o(79954),v=o(85893);const g=b.C$,S=b.GN;function C(e){window.__c={n:"SelectableHoverMenu"};const{store:t,disableDrag:o,hasEditorPermissions:C,isWorkspaceAdmin:w,offsetTop:k}=e,M=(0,i.O7)(),A=(0,i.MO)(),x=(0,n.useRef)(null),y=g,T=S,R=(0,s.VK)((()=>(0,c.zt)(k,t)),[k,t]),j=(0,s.VK)((()=>(0,c.tx)(M,y+2,t)),[M,y,t]),Z=(0,s.VK)((()=>t.isNavigableAncestorLocked()),[t]),I=!o&&C&&!Z,E=(0,r.yK)((()=>({div:{position:"absolute",top:R,left:-j,width:y,height:T,pointerEvents:"auto",cursor:I?"-webkit-grab":void 0},popup:{width:265,overflow:"hidden"}})),[I,j,R,T,y]),[_,B]=(0,n.useState)(""),D=(0,s.VK)((()=>{const e=h.default.state;return e.isOpen&&e.menuIsOpen&&e.currentStore===t}),[t]);(0,n.useEffect)((()=>()=>{D&&h.default.reset()}),[]);const O=(0,n.useCallback)((()=>{const e=h.default.state,o=u.Z.state;if(e.isOpen){B(""),A&&o.phase===u.i.shown?u.Z.onHide((()=>h.default.setState({...e,menuIsOpen:!0}))):h.default.setState({...e,menuIsOpen:!0}),a.Ys({environment:M,store:t});const n=t.getType();n&&l.YM(M,{blockType:n})}}),[M,A,t]),H=(0,n.useCallback)((()=>h.default.reset()),[]);return A?null:(0,v.jsx)("div",{style:E.div,ref:x,children:(0,v.jsx)(f.ZP,{popupType:A?p.Z4.SlideUp:p.Z4.Popup,open:D,placementToOrigin:p.pO.Left,alignmentToOrigin:p.vR.Center,onDismiss:H,originGap:5,forceInitialInbound:!0,style:E.popup,render:()=>(0,v.jsx)(d.LazySelectableHoverMenuPopup,{hasEditorPermissions:C,isWorkspaceAdmin:w,store:t,onDismiss:H,containerRef:x,query:_,setQuery:B}),origin:(0,v.jsx)(m.Z,{store:t,isHoverMenu:!0,canDrag:I,canSelect:!1,analyticsName:"selection_menu",disableForceTouch:!0,disableHorizontalDragEdgeScroll:!0,children:(0,v.jsx)(b.ZP,{width:y,height:T,disallowTabbing:!0,onClick:O,disableDrag:!I})}),trapFocus:D})})}C.width=g,C.height=S;const w=C},98321:(e,t,o)=>{o.d(t,{Z:()=>i});var n=o(67294);const i=function(e,t){if(e.ref&&t.ref){const o=t.ref;t.ref=t=>{e.ref(t),o(t)}}return n.cloneElement(e,t)}},439:(e,t,o)=>{o.d(t,{oJ:()=>p,tx:()=>u,zt:()=>h});var n=o(49271),i=o(41432),s=o(92650),r=o(16472),l=o(50694),a=o(79797),c=o(49117),d=o(98165);function u(e,t,o){if(o.isQuoteBlockChild())return t+r.nr+r.NE+n.ZD.paddingLeft;if(o.isTransclusionType()||o.isInsideTransclusion()||"ai_block"===o.getType()||o.isInsideAiBlock())return t+4;if(o.getType()===i.Ti.table){const n=l.g$.getNumberOfUnresolvedComments({simpleTableStore:o,environment:e,includeInline:!(0,s.fg)(e,o)}),i=o.isImmediateColumnChild();return 0!==n||i?t+8:t}const u=d.qA(o).filter((e=>e instanceof a.zq&&e.isType("duplicate_blocks"))).length;return u>0?t+c.pZ*u:t}function h(e,t){return t.isTransclusionType()?e+5:"ai_block"===t.getType()?t.hasContent()?e+9:e+15:t.getType()===i.Ti.button?e+3:e}function p(e){const t=e.getType(),o=e.getNavigableAncestorFormat(),n=Boolean(o.page_small_text);return t===i.Ti.divider?-6:t===i.Ti.header?n?7:10:t===i.Ti.subHeader?n?4:6:t===i.Ti.collectionView?8:t===i.Ti.table?14:3}}}]);